<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <title>Daftar Kepegawaian</title>
    <link rel="stylesheet" href="Kepegawaian.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      /* Search box kecil di kanan atas tabel */
      .search-container {
        text-align: right;
        margin-bottom: 10px;
      }
      .search-container input {
        padding: 3px;
        font-size: 12px;
      }
      .search-container button {
        padding: 3px 8px;
        font-size: 12px;
        cursor: pointer;
      }

      /* Modal Grafik */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
      }
      .modal-content {
        background: #fff;
        margin: 3% auto;
        padding: 20px;
        border-radius: 8px;
        width: 80%;
        max-width: 1000px;

        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative; /* untuk close button */
      }

      /* Tombol close (X) */
      .close {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 26px;
        font-weight: bold;
        cursor: pointer;
        color: #333;
      }
      .close:hover {
        color: red;
      }

      /* Grafik tersusun vertikal */
      .chart-box {
        text-align: center;
        width: 100%;
        margin: 20px 0;
      }
      .chart-box canvas {
        max-width: 360px !important; /* lebih besar */
        max-height: 360px !important;
        margin: 0 auto;
      }
      .chart-info {
        font-size: 13px;
        margin-top: 6px;
        color: #333;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <div class="navbar">
      <div class="logo"><b>CIKASDA</b></div>
      <div>
        <a href="#" onclick="showPage('grafik')">Grafik</a>
      </div>
    </div>

    <!-- ================== HERO DAN MENU TIDAK DIUBAH ================== -->
    <div class="hero">
      <div class="hero-content">
        <h1>DAFTAR KEPEGAWAIAN</h1>
        <h2>Petugas OP WIL II</h2>
      </div>

      <!-- Tombol menu -->
      <div class="menu">
        <button><a href="PunaKiri.html">Puna kiri</a></button>
        <button><a href="Karopa.html">Karopa</a></button>
        <button><a href="Bakung.Html">Bakung</a></button>
        <button><a href="Ungkaya.html">Ungkaya</a></button>
        <button><a href="Gintu.html">Gintu</a></button>
        <button><a href="dongin.html">Dongin</a></button>
        <button><a href="Tolisu.html">Tolisu</a></button>
        <button><a href="Toili.html">Toili</a></button>
        <button><a href="Moilong.html">Moilong</a></button>
        <button><a href="Karongkasa.html">Karongkasa</a></button>
        <button><a href="Saroso.html">Saroso</a></button>
        <button><a href="BellaBunta.html">Bella bunta</a></button>
        <button><a href="Tamboyali.html">Tamboyali</a></button>
        <button><a href="Waromala.html">Waromala</a></button>
        <button><a href="Grafik.keseluruhan.html">Grafik Keseluruhan</a>
        </button>
      </div>
    </div>

    <!-- ================== TABLE KEPEGAWAIAN (TIDAK DIUBAH) ================== -->
    <section class="table-section">
      <h2>Data Pegawai(BELLABUNTA)</h2>
      <div style="margin-bottom: 10px">
        <button
          onclick="openModal()"
          style="
            padding: 6px 12px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 6px;
            border: none;
            background-color: #564caf;
            color: white;
          "
        >
          Grafik
        </button>
      </div>

      <!-- Search Box -->
      <div class="search-container">
        <input
          type="text"
          id="searchInput"
          placeholder="Cari Nama pegawai ..."
        />
        <button onclick="searchTable()">Search</button>
        <button
          onclick="resetTable()"
          style="padding: 4px 8px; font-size: 12px"
        >
          Reset
        </button>
      </div>

      <div class="table-container">
        <table id="pegawaiTable">
          <thead>
            <tr>
              <th>NO</th>
              <th>NAMA</th>
              <th>TEMPAT, TGL LAHIR</th>
              <th>USIA (TAHUN)</th>
              <th>L/P</th>
              <th>JABATAN</th>
              <th>WILAYAH KERJA</th>
              <th>PNS/CPNS/PPPK/PHL</th>
              <th>PENUGASAN SEBELUMNYA</th>
              <th>PENDIDIKAN TERAKHIR</th>
              <th>KET</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>UNTUNG</td>
              <td>BALI, 31 DECEMBER 1970</td>
              <td>54</td>
              <td>L</td>
              <td>PENGAMAT</td>
              <td>D.I BUNTA DAN D.I BELLA</td>
              <td>PNS</td>
              <td>-</td>
              <td>PAKET C</td>
              <td>-</td>
            </tr>
            <tr>
              <td>2</td>
              <td>AHMAD FAUZI RIDWAN</td>
              <td>SLEMAN, 9 JULI 1998</td>
              <td>27</td>
              <td>L</td>
              <td>JURU</td>
              <td>D.I BUNTA</td>
              <td>CPNS</td>
              <td>-</td>
              <td>DIPLOMA III</td>
              <td>-</td>
            </tr>
            <tr>
              <td>3</td>
              <td>AURILIA SALSA BILA</td>
              <td>BEKASI, 13 MARET 2000</td>
              <td>25</td>
              <td>P</td>
              <td>PPA</td>
              <td>D.I BELLA</td>
              <td>CPNS</td>
              <td>-</td>
              <td>DIPLOMA III</td>
              <td>-</td>
            </tr>
            <tr>
              <td>4</td>
              <td>ANDRIANI NOVRIANTI</td>
              <td>PALEMBANG, 3 NOVEMBER 20011</td>
              <td>23</td>
              <td>L</td>
              <td>PPA</td>
              <td>SUPLESI RANTAU JAYA-BLKA</td>
              <td>CPNS</td>
              <td></td>
              <td>SMK</td>
              <td>-</td>
            </tr>
            <tr>
              <td>5</td>
              <td>ABD RAHMAN</td>
              <td>AMPANA, 30 MEI 2002</td>
              <td>23</td>
              <td>L</td>
              <td>PPA</td>
              <td>BST1-BST2Mk</td>
              <td>CPNS</td>
              <td>-</td>
              <td>SMA</td>
              <td>-</td>
            </tr>
            <tr>
              <td>6</td>
              <td>SUWARDI</td>
              <td>BANYUWANGI, 5 OKTOBER 1968</td>
              <td>56</td>
              <td>L</td>
              <td>PPA</td>
              <td>BDS1-BDS2</td>
              <td>PNS</td>
              <td>-</td>
              <td>SMA</td>
              <td>-</td>
            </tr>
            <td>7</td>
            <td>I WAYAN SUNATA</td>
            <td>BALI, 9 JULI 1977</td>
            <td>48</td>
            <td>L</td>
            <td>PPA</td>
            <td>BBL4-BBL5Mk</td>
            <td>PPPK</td>
            <td>-</td>
            <td>DIPLOMA III</td>
            <td>-</td>
            <tr>
              <td>8</td>
              <td>BAWON ISWANTO</td>
              <td>SONOWANGI,14 AGUSTUS 1979</td>
              <td>45</td>
              <td>L</td>
              <td>PPA</td>
              <td>BS1-BS3</td>
              <td>PPPK</td>
              <td>-</td>
              <td>STM</td>
              <td>-</td>
            </tr>
            <tr>
              <td>9</td>
              <td>ABDULAH</td>
              <td>BUNTA, 9 SEPTEMBER 1971</td>
              <td>53</td>
              <td>L</td>
              <td>PPA</td>
              <td>BL4-BL5</td>
              <td>PPPK</td>
              <td>-</td>
              <td>SMA</td>
              <td>-</td>
            </tr>
            <tr>
              <td>10</td>
              <td>SUAJI</td>
              <td>TULUNGAGUNG, 21 APRIL 1971</td>
              <td>54</td>
              <td>L</td>
              <td>PPA</td>
              <td>BJ1-BJ4</td>
              <td>PHL</td>
              <td>-</td>
              <td>PAKET C</td>
              <td>IKUT UJIAN PPPK TAHAP I</td>
            </tr>
            <tr>
              <td>11</td>
              <td>I WAYAN SUDIASA</td>
              <td>TABANAN BALI, 10 FEBRUARI 1974</td>
              <td>51</td>
              <td>L</td>
              <td>PPA</td>
              <td>BDS3-BDS5</td>
              <td>PHL</td>
              <td>-</td>
              <td>STM</td>
              <td>IKUT UJIAN PPPK TAHAP I</td>
            </tr>
            <tr>
              <td>12</td>
              <td>CUCU ARYAWAN</td>
              <td>RANTAU JAYA, 22 AGUSTUS 1994</td>
              <td>30</td>
              <td>L</td>
              <td>PPA</td>
              <td>BL1-BL3</td>
              <td>PHL</td>
              <td>-</td>
              <td>SMA</td>
              <td>Ikut ujian PPPK tahap 1</td>
            </tr>
            <tr>
              <td>13</td>
              <td>ABDUL KADIR SALEH</td>
              <td>LAMU, 18 JULI 1996</td>
              <td>28</td>
              <td>L</td>
              <td>PPA</td>
              <td>BBL1-BBL4</td>
              <td>PPPK</td>
              <td>DINAS BINAMARGA</td>
              <td>SMA</td>
              <td>-</td>
            </tr>
            <tr>
              <td>14</td>
              <td>MUKMINA</td>
              <td>KOTA BAUBAU, 17 NOVEMBER 1983</td>
              <td>41</td>
              <td>P</td>
              <td>PPA</td>
              <td>BKL1-BSD1-BSD2</td>
              <td>PPPK</td>
              <td>SMK N MARITIM BANGGAI</td>
              <td>SMA</td>
              <td>-</td>
            </tr>
            <tr>
              <td>15</td>
              <td>WIDI FIRMAN SETIAWAN</td>
              <td>KEBUMEN, 25 APRIL 1992</td>
              <td>33</td>
              <td>L</td>
              <td>PPA</td>
              <td>BT1-BD1-INTAKE-BUNTA</td>
              <td>PPPK</td>
              <td>DINAS DUKCAPIL</td>
              <td>SMA</td>
              <td>-</td>
            </tr>
            <tr>
              <td>16</td>
              <td>NAFILAH</td>
              <td>PALU, 26 AGUSTUS 1999</td>
              <td>25</td>
              <td>P</td>
              <td>PPA</td>
              <td>BSPA1-SPA1Tg-BMkA1-BSPA1-BSPA2-BMSPA2</td>
              <td>PPPK</td>
              <td>DINAS BINAMARGA</td>
              <td>SMK</td>
              <td>-</td>
            </tr>
            <tr>
              <td>17</td>
              <td>MEGAWATI T HASIM</td>
              <td>TOLITOLI, 19 FEBRUARI 1991</td>
              <td>34</td>
              <td>P</td>
              <td>PPA</td>
              <td>INTAKE LAONGGO</td>
              <td>PPPK</td>
              <td>SLB N PALELE</td>
              <td>SMA</td>
              <td>-</td>
            </tr>
            <tr>
              <td>18</td>
              <td>ADI RIFAI</td>
              <td>DONGGALA, 31 JANUARI 1976</td>
              <td>49</td>
              <td>L</td>
              <td>PPA</td>
              <td>BD2-BD3-BD4</td>
              <td>PPPK</td>
              <td>SMA N 4 PALU</td>
              <td>SMA</td>
              <td>-</td>
            </tr>
            <tr>
              <td>19</td>
              <td>DIKI RIZALDI</td>
              <td>MAMBORO, 1 FEBRUARI 1997</td>
              <td>28</td>
              <td>L</td>
              <td>POB</td>
              <td>BENDUNG BELLA KANAN</td>
              <td>PPPK</td>
              <td>DINAS PEMBERDAYAAN PEREMPUAN DAN PERLINDUNGAN ANAK</td>
              <td>SMA</td>
              <td>-</td>
            </tr>
            <tr>
              <td>20</td>
              <td>MOH. FAHMI DAENG MALINDU</td>
              <td>KASIMBAR, 20 SEPTEBER 1994</td>
              <td>30</td>
              <td>L</td>
              <td>POB</td>
              <td>BENDUNG BUNTA</td>
              <td>PPPK</td>
              <td>SMA N 2 KASIMBAR</td>
              <td>SMA</td>
              <td>-</td>
            </tr>
            <tr>
              <td>21</td>
              <td>BERNAT TIKAT</td>
              <td>GONOHOP, 29 OKTOBER 1978</td>
              <td>46</td>
              <td>L</td>
              <td>POB</td>
              <td>BENDUNG BUNTA</td>
              <td>PPPK</td>
              <td>-</td>
              <td>SMA</td>
              <td>-</td>
            </tr>
            <tr>
              <td>22</td>
              <td>DAVIT IHSAN MAIN</td>
              <td>JAYA MAKMUR, 21 JANUARI 2001</td>
              <td>24</td>
              <td>L</td>
              <td>POB</td>
              <td>BENDUNG BELLA KIRI</td>
              <td>PHL</td>
              <td>-</td>
              <td>SMA</td>
              <td>TIDAK IKUT UJIAN SAMA SEKALI</td>
            </tr>
            <tr>
              <td>23</td>
              <td>RAHMAT HIDAYAT</td>
              <td>DWIPAKARYA, 4 FEBRUARI 1998</td>
              <td>27</td>
              <td>L</td>
              <td>STAF PEMELIHARAAN</td>
              <td>STAF PEMELIHARAAN</td>
              <td>PHL</td>
              <td>-</td>
              <td>SMA</td>
              <td>IKUT UJIAN PPPK TAHAP II</td>
            </tr>
            <tr>
              <td>24</td>
              <td>RAHMATUL UMMAH</td>
              <td>BERINGIN JAYA, 12 Januari 2002</td>
              <td>23</td>
              <td>P</td>
              <td>STAF OPERASI</td>
              <td>STAF OPERASI</td>
              <td>PHL</td>
              <td>-</td>
              <td>SMA</td>
              <td>TIDAK IKUT UJIAN SAMA SEKALI</td>
            </tr>

              <!-- Tambahkan data lain sesuai kebutuhan -->
            </tr>
          </tbody>
        </table>
      </div>
    </section>
    <!-- ================== MODAL GRAFIK ================== -->
    <div id="grafikModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Statistik Pegawai</h2>

        <div class="chart-box">
          <h3>Jenis Kelamin</h3>
          <canvas id="genderChart"></canvas>
          <div id="genderInfo" class="chart-info"></div>
        </div>

        <div class="chart-box">
          <h3>Jabatan</h3>
          <canvas id="jabatanChart"></canvas>
          <div id="jabatanInfo" class="chart-info"></div>
        </div>

        <div class="chart-box">
          <h3>Status Kepegawaian</h3>
          <canvas id="statusChart"></canvas>
          <div id="statusInfo" class="chart-info"></div>
        </div>

        <div class="chart-box">
          <h3>Pendidikan Terakhir</h3>
          <canvas id="pendidikanChart"></canvas>
          <div id="pendidikanInfo" class="chart-info"></div>
        </div>

        <div class="chart-box big">
          <h3>Kategori Usia</h3>
          <canvas id="usiaChart"></canvas>
          <div id="usiaInfo" class="chart-info"></div>
        </div>
      </div>
    </div>

    <script>
      // ================== Fungsi Search ==================
      function searchTable() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let table = document.getElementById("pegawaiTable");
        let rows = table.getElementsByTagName("tr");
        let firstMatch = null;

        for (let i = 1; i < rows.length; i++) {
          let namaCell = rows[i].getElementsByTagName("td")[1];
          if (namaCell) {
            let nama = namaCell.textContent || namaCell.innerText;
            if (nama.toLowerCase().indexOf(input) > -1) {
              rows[i].style.display = "";
              if (!firstMatch) {
                firstMatch = rows[i];
              }
            } else {
              rows[i].style.display = "none";
            }
          }
        }

        if (firstMatch) {
          firstMatch.scrollIntoView({ behavior: "smooth", block: "center" });
          firstMatch.style.backgroundColor = "#ffff99";
        }
      }

      function resetTable() {
        let table = document.getElementById("pegawaiTable");
        let rows = table.getElementsByTagName("tr");

        for (let i = 1; i < rows.length; i++) {
          rows[i].style.display = "";
          rows[i].style.backgroundColor = "";
        }

        document.getElementById("searchInput").value = "";
      }

      // ================== Modal ==================
      function openModal() {
        document.getElementById("grafikModal").style.display = "block";
        loadCharts();
      }

      function closeModal() {
        document.getElementById("grafikModal").style.display = "none";
      }

      // ================== Chart.js ==================
      function getTableData() {
        let table = document.getElementById("pegawaiTable");
        let rows = table.getElementsByTagName("tr");

        let gender = { L: 0, P: 0 };
        let jabatan = {};
        let status = {};
        let pendidikan = {};
        let usia = {
          "15-24 Tahun (Usia Muda)": 0,
          "25-34 Tahun (Pekerja Awal)": 0,
          "35-44 Tahun (Paruh Baya)": 0,
          "45-54 Tahun (Pra Pensiun)": 0,
          "55-64 Tahun (Pensiun)": 0,
        };

        for (let i = 1; i < rows.length; i++) {
          let cells = rows[i].getElementsByTagName("td");
          if (cells.length > 0) {
            let g = cells[4].innerText;
            let j = cells[5].innerText;
            let s = cells[7].innerText;
            let p = cells[9].innerText;
            let u = parseInt(cells[3].innerText);

            if (g) gender[g] = (gender[g] || 0) + 1;
            if (j) jabatan[j] = (jabatan[j] || 0) + 1;
            if (s) status[s] = (status[s] || 0) + 1;
            if (p) pendidikan[p] = (pendidikan[p] || 0) + 1;
            if (!isNaN(u)) {
              if (u >= 15 && u <= 24) usia["15-24 Tahun (Usia Muda)"]++;
              else if (u >= 25 && u <= 34) usia["25-34 Tahun (Pekerja Awal)"]++;
              else if (u >= 35 && u <= 44) usia["35-44 Tahun (Paruh Baya)"]++;
              else if (u >= 45 && u <= 54) usia["45-54 Tahun (Pra Pensiun)"]++;
              else if (u >= 55 && u <= 64) usia["55-64 Tahun (Pensiun)"]++;
            }
          }
        }

        return { gender, jabatan, status, pendidikan, usia };
      }

      function createChart(ctx, type, data, textBoxId) {
        new Chart(ctx, {
          type: type,
          data: data,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              tooltip: {
                callbacks: {
                  label: function (tooltipItem) {
                    let value = tooltipItem.raw;
                    let total = tooltipItem.chart._metasets[0].total;
                    let percent = ((value / total) * 100).toFixed(1);
                    return `${tooltipItem.label}: ${value} orang (${percent}%)`;
                  },
                },
              },
            },
          },
        });

        let total = data.datasets[0].data.reduce((a, b) => a + b, 0);
        let html = "";
        data.labels.forEach((label, i) => {
          let value = data.datasets[0].data[i];
          let percent = ((value / total) * 100).toFixed(1);
          html += `${label}: ${value} orang (${percent}%)<br>`;
        });
        document.getElementById(textBoxId).innerHTML = html;
      }

      function loadCharts() {
        let { gender, jabatan, status, pendidikan, usia } = getTableData();

        createChart(
          document.getElementById("genderChart"),
          "pie",
          {
            labels: Object.keys(gender),
            datasets: [
              {
                data: Object.values(gender),
                backgroundColor: ["#36A2EB", "#FF6384"],
              },
            ],
          },
          "genderInfo"
        );

        createChart(
          document.getElementById("jabatanChart"),
          "pie",
          {
            labels: Object.keys(jabatan),
            datasets: [
              {
                data: Object.values(jabatan),
                backgroundColor: ["#FFCE56", "#4BC0C0", "#9966FF", "#FF9F40"],
              },
            ],
          },
          "jabatanInfo"
        );

        createChart(
          document.getElementById("statusChart"),
          "pie",
          {
            labels: Object.keys(status),
            datasets: [
              {
                data: Object.values(status),
                backgroundColor: ["#36A2EB", "#FF6384", "#FFCE56", "#4BC0C0"],
              },
            ],
          },
          "statusInfo"
        );

        createChart(
          document.getElementById("pendidikanChart"),
          "pie",
          {
            labels: Object.keys(pendidikan),
            datasets: [
              {
                data: Object.values(pendidikan),
                backgroundColor: [
                  "#FF6384",
                  "#36A2EB",
                  "#FFCE56",
                  "#9966FF",
                  "#4BC0C0",
                ],
              },
            ],
          },
          "pendidikanInfo"
        );

        createChart(
          document.getElementById("usiaChart"),
          "pie",
          {
            labels: Object.keys(usia),
            datasets: [
              {
                data: Object.values(usia),
                backgroundColor: [
                  "#FF6384",
                  "#36A2EB",
                  "#FFCE56",
                  "#9966FF",
                  "#4BC0C0",
                ],
              },
            ],
          },
          "usiaInfo"
        );
      }
    </script>
  </body>
</html>
